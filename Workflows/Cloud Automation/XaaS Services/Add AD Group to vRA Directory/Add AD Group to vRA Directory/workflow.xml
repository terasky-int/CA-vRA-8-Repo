<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:workflow xmlns:ns2="http://vmware.com/vco/workflow" root-name="item13" object-name="workflow:name=generic" id="9c280a87-39d1-40b0-8748-942c8d198f60" editor-version="2.0" version="0.0.1" api-version="6.0.0" allowed-operations="vfe" restartMode="1" resumeFromFailedMode="0">
    <display-name>Add AD Group to vRA Directory</display-name>
    <position y="50.0" x="40.0"/>
    <input>
        <param name="dnsGroups" type="Array/AD:UserGroup"/>
        <param name="organizationId" type="string"/>
    </input>
    <output>
        <param name="result" type="boolean"/>
    </output>
    <attrib name="addedSucceded" type="boolean">
        <value encoded="n">false</value>
    </attrib>
    <attrib name="vidmRest" type="REST:RESTHost">
        <value encoded="n">dunes://service.dunes.ch/CustomSDKObject?id='dcc2b853-e231-4316-9ca2-9efd2afbb55a'&amp;dunesName='REST:RESTHost'</value>
    </attrib>
    <attrib name="username" type="string">
        <value encoded="n"></value>
    </attrib>
    <attrib name="password" type="SecureString">
        <value encoded="n"></value>
    </attrib>
    <attrib name="directoryName" type="string">
        <value encoded="n">terasky.local</value>
    </attrib>
    <attrib name="syncResult" type="string">
        <value encoded="n"></value>
    </attrib>
    <attrib name="configCE" type="ConfigurationElement">
        <value encoded="n">dunes://service.dunes.ch/ConfigurationElement?id='308f99ce-c93f-41d2-b981-3f68797ffcc3'&amp;dunesName='ConfigurationElement'</value>
    </attrib>
    <workflow-item name="item0" type="end" end-mode="0" comparator="0">
        <in-binding/>
        <out-binding/>
        <position y="50.0" x="930.0"/>
    </workflow-item>
    <workflow-item name="item3" out-name="item11" alt-out-name="item10" type="condition" comparator="0">
        <display-name>Added Succed?</display-name>
        <script encoded="false">// Generated by the system, cannot be edited
return (addedSucceded === true);</script>
        <in-binding>
            <bind name="addedSucceded" type="boolean" export-name="addedSucceded"/>
        </in-binding>
        <out-binding/>
        <condition name="addedSucceded" type="boolean" comparator="0" label="null">false</condition>
        <position y="50.0" x="560.0"/>
    </workflow-item>
    <workflow-item name="item4" throw-bind-name="errorCode" type="end" end-mode="1" comparator="0">
        <in-binding/>
        <out-binding/>
        <position y="180.0" x="600.0"/>
    </workflow-item>
    <workflow-item name="item8" out-name="item3" type="task" comparator="0">
        <display-name>Add Groups To vRA Directory</display-name>
        <script encoded="false">addedSucceded = true
//var orgId = System.getModule('com.amdocs.migration').getTenantByNameOrId(tenant)

var orgId = System.getContext().getParameter('__metadata_orgId')

if (!orgId)
{
    orgId = organizationId
}

for each(var group in dnsGroups)
{
    try
    {
        System.getModule("com.ca.vra.directory").assignEnterpriseRoles(group.name, orgId);
        System.warn('Added group ' + group.name)  
    }
    catch(err)
    {
        System.warn('Could not add group ' + group.name)
        addedSucceded = false
    }
}</script>
        <in-binding>
            <bind name="dnsGroups" type="Array/AD:UserGroup" export-name="dnsGroups"/>
            <bind name="organizationId" type="string" export-name="organizationId"/>
        </in-binding>
        <out-binding>
            <bind name="addedSucceded" type="boolean" export-name="addedSucceded"/>
        </out-binding>
        <description>Simple task with custom script capability.</description>
        <position y="60.0" x="380.0"/>
    </workflow-item>
    <workflow-item name="item9" out-name="item8" type="task" script-module="com.ca.vra.directory/syncIdm" comparator="0">
        <display-name>syncIdm</display-name>
        <script encoded="false">//Auto generated script, cannot be modified !
actionResult = System.getModule("com.ca.vra.directory").syncIdm(vidmRest, username, password, directoryName);
</script>
        <in-binding>
            <bind name="vidmRest" type="REST:RESTHost" export-name="vidmRest"/>
            <bind name="username" type="string" export-name="username"/>
            <bind name="password" type="SecureString" export-name="password"/>
            <bind name="directoryName" type="string" export-name="directoryName"/>
        </in-binding>
        <out-binding>
            <bind name="actionResult" type="string" export-name="syncResult"/>
        </out-binding>
        <description>Add a note to the workflow schema.</description>
        <position y="60.0" x="260.0"/>
    </workflow-item>
    <workflow-item name="item10" out-name="item4" type="task" comparator="0">
        <display-name>Log</display-name>
        <script encoded="false">System.warn('Workflow ended with errors')</script>
        <in-binding/>
        <out-binding/>
        <description>Simple task with custom script capability.</description>
        <position y="130.0" x="560.0"/>
    </workflow-item>
    <workflow-item name="item11" out-name="item12" type="task" script-module="com.ca.vra.directory/syncIdm" comparator="0">
        <display-name>syncIdm</display-name>
        <script encoded="false">//Auto generated script, cannot be modified !
actionResult = System.getModule("com.ca.vra.directory").syncIdm(vidmRest, username, password, directoryName);
</script>
        <in-binding>
            <bind name="vidmRest" type="REST:RESTHost" export-name="vidmRest"/>
            <bind name="username" type="string" export-name="username"/>
            <bind name="password" type="SecureString" export-name="password"/>
            <bind name="directoryName" type="string" export-name="directoryName"/>
        </in-binding>
        <out-binding>
            <bind name="actionResult" type="string" export-name=""/>
        </out-binding>
        <description>Add a note to the workflow schema.</description>
        <position y="60.0" x="690.0"/>
    </workflow-item>
    <workflow-item name="item12" out-name="item0" type="task" comparator="0">
        <display-name>Output result</display-name>
        <script encoded="false">result = addedSucceded</script>
        <in-binding>
            <bind name="addedSucceded" type="boolean" export-name="addedSucceded"/>
        </in-binding>
        <out-binding>
            <bind name="result" type="boolean" export-name="result"/>
        </out-binding>
        <description>Simple task with custom script capability.</description>
        <position y="60.0" x="785.0"/>
    </workflow-item>
    <workflow-item name="item13" out-name="item9" type="task" comparator="0">
        <display-name>Get IDM Config</display-name>
        <script encoded="false">username = configCE.getAttributeWithKey('username').value&#13;
password = configCE.getAttributeWithKey('password').value</script>
        <in-binding>
            <bind name="configCE" type="ConfigurationElement" export-name="configCE"/>
        </in-binding>
        <out-binding>
            <bind name="username" type="string" export-name="username"/>
            <bind name="password" type="SecureString" export-name="password"/>
        </out-binding>
        <description>Simple task with custom script capability.</description>
        <position y="60.0" x="100.0"/>
    </workflow-item>
</ns2:workflow>
